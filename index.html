<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VideoHub - All Platforms Supported</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 15px; 
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .container { 
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px 0;
            border-bottom: 1px solid #333;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #e50914, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .tagline {
            color: #888;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .btn { 
            background: linear-gradient(45deg, #e50914, #ff4757);
            color: white; 
            padding: 12px 18px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(229, 9, 20, 0.3);
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #333, #555);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #ff6b6b);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        
        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #20c997);
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            margin: 2px;
            min-height: 36px;
        }
        
        .movie { 
            background: rgba(42, 42, 42, 0.8);
            padding: 15px; 
            margin: 12px 0; 
            border-radius: 12px;
            border: 1px solid #333;
            backdrop-filter: blur(10px);
        }
        
        .movie-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .movie-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
            flex: 1;
            margin-right: 10px;
        }
        
        .movie-category {
            background: linear-gradient(45deg, #e50914, #ff6b6b);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .movie-description {
            color: #ccc;
            font-size: 14px;
            line-height: 1.4;
            margin: 10px 0;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            margin: 10px 0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        
        .instagram-container {
            width: 100%;
            max-width: 400px;
            margin: 10px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .facebook-container {
            width: 100%;
            max-width: 500px;
            margin: 10px auto;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .movie-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #333;
        }
        
        .user-badge {
            background: #333;
            color: #ccc;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        input, textarea, select { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            background: #222; 
            color: white; 
            border: 1px solid #444; 
            border-radius: 8px;
            font-size: 16px;
            min-height: 44px;
        }
        
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23ffffff' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }
        
        .form-container {
            background: rgba(42, 42, 42, 0.9);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 20px;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .url-help {
            font-size: 12px;
            color: #888;
            margin-top: -5px;
            margin-bottom: 10px;
        }
        
        .tab-buttons {
            display: flex;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
            background: #333;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: #333;
            border: none;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px;
        }
        
        .tab-btn.active {
            background: #e50914;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .platform-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            z-index: 10;
        }

        /* Fullscreen Button Styles */
        .fullscreen-btn {
            background: linear-gradient(45deg, #666, #888);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
            transition: all 0.3s ease;
        }

        .fullscreen-btn:hover {
            background: linear-gradient(45deg, #777, #999);
        }

        /* Categories Section */
        .categories-section {
            margin: 20px 0;
            text-align: center;
        }
        
        .categories-title {
            font-size: 16px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .categories-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin: 10px 0;
        }
        
        .category-btn {
            background: #333;
            color: #ccc;
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            min-height: 36px;
        }
        
        .category-btn.active {
            background: #e50914;
            color: white;
        }
        
        .category-btn:hover {
            background: #444;
        }

        /* Search Section */
        .search-section {
            margin: 20px 0;
            text-align: center;
        }
        
        .search-box {
            max-width: 400px;
            margin: 0 auto;
        }

        /* Professional Comments Section - YouTube Style */
        .comments-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }
        
        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .comments-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }
        
        .comments-count {
            background: #444;
            color: #ccc;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .comment-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .comment-input {
            flex: 1;
            padding: 12px;
            background: #222;
            border: 1px solid #444;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            min-height: 44px;
            resize: none;
        }
        
        .comment-btn {
            background: #e50914;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            min-height: 44px;
            font-weight: 500;
        }
        
        .comments-toggle {
            background: transparent;
            color: #e50914;
            border: none;
            padding: 8px 0;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .comments-preview {
            margin-bottom: 15px;
        }
        
        .preview-comment {
            background: #333;
            padding: 12px;
            border-radius: 10px;
            border-left: 3px solid #e50914;
        }
        
        .preview-user {
            font-weight: bold;
            color: #e50914;
            font-size: 13px;
            margin-bottom: 5px;
        }
        
        .preview-text {
            color: #ccc;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .comments-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .comments-list.expanded {
            max-height: 400px;
        }
        
        .comment-item {
            background: #333;
            padding: 12px;
            margin: 8px 0;
            border-radius: 10px;
            border-left: 3px solid #444;
            animation: fadeIn 0.3s ease;
        }
        
        .comment-user {
            font-weight: bold;
            color: #e50914;
            font-size: 13px;
            margin-bottom: 5px;
        }
        
        .comment-text {
            color: #ccc;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .comment-time {
            font-size: 11px;
            color: #888;
            text-align: right;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                touch-action: pan-y pinch-zoom;
            }
            
            .movie-header {
                flex-direction: column;
                gap: 8px;
            }
            
            .movie-title {
                margin-right: 0;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group .btn {
                margin: 3px 0;
            }
            
            .categories-container {
                justify-content: flex-start;
                overflow-x: auto;
                padding: 10px 0;
                -webkit-overflow-scrolling: touch;
            }
            
            .comment-form {
                flex-direction: column;
            }
            
            .instagram-container,
            .facebook-container {
                max-width: 100%;
            }
            
            input, textarea, select {
                font-size: 16px;
            }
            
            .comments-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        /* Prevent zoom on input focus */
        @media screen and (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }

        /* Disable double tap to zoom */
        * {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>
    <div class="container">
        <script type="text/javascript">
	atOptions = {
		'key' : '1cb4836d1181cec93eeaf530d5fae232',
		'format' : 'iframe',
		'height' : 250,
		'width' : 300,
		'params' : {}
	};
</script>
<script type="text/javascript">
	atOptions = {
		'key' : '730ffc4cd0cbe4501c1e43303ba673f7',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/730ffc4cd0cbe4501c1e43303ba673f7/invoke.js"></script>
        <div class="header">
            <div class="logo">üé¨ VideoHub Pro</div>
            <div class="tagline">Your Ultimate Video Collection - All Platforms Supported</div>
        </div>
        
        <!-- Search Section -->
        <div class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Search videos by title or category..." 
                       onkeyup="handleSearch()" style="width: 100%;">
            </div>
        </div>
        
        <!-- Categories Section -->
        <div class="categories-section">
            <div class="categories-title">Browse by Category:</div>
            <div class="categories-container" id="categoriesList">
                <!-- Categories will be loaded here -->
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn" onclick="showForm()">‚ûï Add Video</button>
            <button class="btn btn-secondary" onclick="loadMovies()">üîÑ Refresh All</button>
            <button class="btn btn-info" onclick="showAllMovies()">üì∫ Show All Videos</button>
        </div>
        
        <!-- Add Video Form -->
        <div id="form" class="form-container">
            <div class="form-header">Add New Video</div>
            <input type="text" id="title" placeholder="Video Title *" required>
            
            <!-- Fixed Categories Dropdown -->
            <select id="category" required>
                <option value="">Select Category *</option>
                <option value="Action">Action</option>
                <option value="Comedy">Comedy</option>
                <option value="Drama">Drama</option>
                <option value="Sci-fi">Sci-fi</option>
                <option value="Horror">Horror</option>
                <option value="Romance">Romance</option>
                <option value="Thriller">Thriller</option>
                <option value="Animation">Animation</option>
                <option value="Documentary">Documentary</option>
                <option value="Music">Music</option>
                <option value="Sports">Sports</option>
                <option value="Educational">Educational</option>
                <option value="Entertainment">Entertainment</option>
            </select>
            
            <div class="tab-buttons">
                <button type="button" class="tab-btn active" onclick="switchTab('urlTab')">üåê Video URL</button>
                <button type="button" class="tab-btn" onclick="switchTab('iframeTab')">üì∫ Embed Code</button>
            </div>
            
            <div id="urlTab" class="tab-content active">
                <input type="text" id="videoUrl" placeholder="Paste Video URL *">
                <div class="url-help">
                    Supported Platforms:<br>
                    ‚Ä¢ YouTube: https://www.youtube.com/watch?v=VIDEO_ID<br>
                    ‚Ä¢ Instagram: https://www.instagram.com/reel/REEL_ID/<br>
                    ‚Ä¢ Facebook: https://www.facebook.com/watch/?v=VIDEO_ID<br>
                    ‚Ä¢ Vimeo: https://vimeo.com/VIDEO_ID<br>
                    ‚Ä¢ Dailymotion: https://www.dailymotion.com/video/VIDEO_ID
                </div>
            </div>
            
            <div id="iframeTab" class="tab-content">
                <textarea id="iframeCode" placeholder="Paste Embed Iframe Code *" rows="3"></textarea>
                <div class="url-help">
                    Paste full iframe code from any video platform<br>
                    Example: &lt;iframe src="..."&gt;&lt;/iframe&gt;
                </div>
            </div>
            
            <textarea id="desc" placeholder="Description" rows="2"></textarea>
            
            <div class="button-group">
                <button class="btn btn-success" onclick="addMovie()">üíæ Save Video</button>
                <button class="btn btn-secondary" onclick="hideForm()">‚ùå Cancel</button>
            </div>
        </div>
        
        <!-- Videos List -->
        <div id="movies"></div>
    </div>

    <script>
        // üî• YAHAN APNA SUPABASE URL AUR API KEY DALEN
        const supabaseUrl = 'https://vpyhzixjiwlvflmrmywr.supabase.co';
        const supabaseKey = 'sb_publishable_O4F_qebV8fdyGm06vw6O0Q_zzLP9fSo';
        
        let supabase;
        let currentUser = 'user_' + Math.random().toString(36).substr(2, 9);
        let currentCategory = 'all';
        let currentSearch = '';

        // Fixed categories array
        const fixedCategories = [
            'Action', 'Comedy', 'Drama', 'Sci-fi', 'Horror', 
            'Romance', 'Thriller', 'Animation', 'Adult'
            
        ];

        document.addEventListener('DOMContentLoaded', function() {
            supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            console.log('‚úÖ VideoHub Pro initialized');
            loadCategories();
            loadMovies();
            
            // Prevent zoom on double tap
            document.addEventListener('touchstart', function(event) {
                if (event.touches.length > 1) {
                    event.preventDefault();
                }
            });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });

        function showForm() {
            document.getElementById('form').style.display = 'block';
            switchTab('urlTab');
            document.getElementById('videoUrl').value = '';
            document.getElementById('iframeCode').value = '';
            document.getElementById('category').value = '';
        }

        function hideForm() {
            document.getElementById('form').style.display = 'none';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // YouTube URL ‡§∏‡•á video ID extract ‡§ï‡§∞‡§®‡§æ
        function getYouTubeVideoId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        // Vimeo URL ‡§∏‡•á video ID extract ‡§ï‡§∞‡§®‡§æ
        function getVimeoVideoId(url) {
            const regex = /(?:vimeo\.com\/|player\.vimeo\.com\/video\/)([0-9]+)/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        // Dailymotion URL ‡§∏‡•á video ID extract ‡§ï‡§∞‡§®‡§æ
        function getDailymotionVideoId(url) {
            const regex = /(?:dailymotion\.com\/video\/|dai\.ly\/)([a-zA-Z0-9]+)/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        // Instagram Reel/Post URL ‡§∏‡•á embed code generate ‡§ï‡§∞‡§®‡§æ
        function getInstagramEmbedCode(url) {
            const reelRegex = /instagram\.com\/(?:p|reel)\/([a-zA-Z0-9_-]+)/;
            const storyRegex = /instagram\.com\/stories\/([a-zA-Z0-9_-]+)/;
            
            const reelMatch = url.match(reelRegex);
            const storyMatch = url.match(storyRegex);
            
            if (reelMatch) {
                const postId = reelMatch[1];
                return `
                    <div class="instagram-container">
                        <div class="platform-badge">üì∑ Instagram</div>
                        <iframe 
                            src="https://www.instagram.com/p/${postId}/embed/"
                            width="100%" 
                            height="500" 
                            frameborder="0" 
                            scrolling="no" 
                            allowtransparency="true"
                            allowfullscreen
                            allow="fullscreen"
                            webkitallowfullscreen
                            mozallowfullscreen>
                        </iframe>
                    </div>
                `;
            }
            
            if (storyMatch) {
                const storyId = storyMatch[1];
                return `
                    <div class="instagram-container">
                        <div class="platform-badge">üì∑ Instagram Story</div>
                        <iframe 
                            src="https://www.instagram.com/stories/${storyId}/embed/"
                            width="100%" 
                            height="700" 
                            frameborder="0" 
                            scrolling="no" 
                            allowtransparency="true"
                            allowfullscreen
                            allow="fullscreen"
                            webkitallowfullscreen
                            mozallowfullscreen>
                        </iframe>
                    </div>
                `;
            }
            
            return null;
        }

        // Facebook Video URL ‡§∏‡•á embed code generate ‡§ï‡§∞‡§®‡§æ
        function getFacebookEmbedCode(url) {
            const watchRegex = /facebook\.com\/watch\/\?v=(\d+)/;
            const reelRegex = /facebook\.com\/reel\/(\d+)/;
            const videoRegex = /facebook\.com\/[^\/]+\/videos\/(\d+)/;
            
            const watchMatch = url.match(watchRegex);
            const reelMatch = url.match(reelRegex);
            const videoMatch = url.match(videoRegex);
            
            let videoId = null;
            
            if (watchMatch) videoId = watchMatch[1];
            else if (reelMatch) videoId = reelMatch[1];
            else if (videoMatch) videoId = videoMatch[1];
            
            if (videoId) {
                return `
                    <div class="facebook-container">
                        <div class="platform-badge">üë• Facebook</div>
                        <iframe 
                            src="https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(url)}&show_text=0&width=500"
                            width="100%" 
                            height="400" 
                            style="border:none;overflow:hidden" 
                            scrolling="no" 
                            frameborder="0" 
                            allowfullscreen="true" 
                            allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share; fullscreen"
                            webkitallowfullscreen
                            mozallowfullscreen>
                        </iframe>
                    </div>
                `;
            }
            
            return null;
        }

        // Iframe code automatically fix ‡§ï‡§∞‡§®‡§æ - FULLSCREEN SUPPORT
        function fixIframePermissions(iframeCode) {
            let fixedCode = iframeCode;
            
            // Remove autoplay to prevent multiple videos playing
            fixedCode = fixedCode.replace(/autoplay;?\s*/g, '');
            fixedCode = fixedCode.replace(/allow="[^"]*autoplay[^"]*"/g, '');
            
            // Add fullscreen permissions if missing
            if (!fixedCode.includes('allowfullscreen')) {
                fixedCode = fixedCode.replace('<iframe', '<iframe allowfullscreen');
            }
            
            // Add modern fullscreen permission
            if (!fixedCode.includes('allow="')) {
                fixedCode = fixedCode.replace('<iframe', '<iframe allow="fullscreen"');
            } else if (!fixedCode.includes('fullscreen')) {
                fixedCode = fixedCode.replace('allow="', 'allow="fullscreen; ');
            }
            
            // Add browser-specific support
            if (!fixedCode.includes('webkitallowfullscreen')) {
                fixedCode = fixedCode.replace('<iframe', '<iframe webkitallowfullscreen');
            }
            if (!fixedCode.includes('mozallowfullscreen')) {
                fixedCode = fixedCode.replace('<iframe', '<iframe mozallowfullscreen');
            }
            
            return fixedCode;
        }

        // URL ‡§∏‡•á automatically embed code generate ‡§ï‡§∞‡§®‡§æ
        function generateEmbedFromUrl(url) {
            if (!url) return null;

            // Instagram check
            const instagramEmbed = getInstagramEmbedCode(url);
            if (instagramEmbed) return instagramEmbed;

            // Facebook check
            const facebookEmbed = getFacebookEmbedCode(url);
            if (facebookEmbed) return facebookEmbed;

            // YouTube check
            const youtubeId = getYouTubeVideoId(url);
            if (youtubeId) {
                return `
                    <div class="video-container">
                        <div class="platform-badge">üì∫ YouTube</div>
                        <iframe 
                            width="100%" 
                            height="315" 
                            src="https://www.youtube.com/embed/${youtubeId}" 
                            frameborder="0" 
                            allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
                            allowfullscreen
                            webkitallowfullscreen
                            mozallowfullscreen>
                        </iframe>
                    </div>
                `;
            }

            // Vimeo check
            const vimeoId = getVimeoVideoId(url);
            if (vimeoId) {
                return `
                    <div class="video-container">
                        <div class="platform-badge">üé¨ Vimeo</div>
                        <iframe 
                            src="https://player.vimeo.com/video/${vimeoId}" 
                            width="100%" 
                            height="360" 
                            frameborder="0" 
                            allow="autoplay; fullscreen; picture-in-picture; fullscreen"
                            allowfullscreen
                            webkitallowfullscreen
                            mozallowfullscreen>
                        </iframe>
                    </div>
                `;
            }

            // Dailymotion check
            const dailymotionId = getDailymotionVideoId(url);
            if (dailymotionId) {
                return `
                    <div class="video-container">
                        <div class="platform-badge">üìπ Dailymotion</div>
                        <iframe 
                            frameborder="0" 
                            width="100%" 
                            height="360" 
                            src="https://www.dailymotion.com/embed/video/${dailymotionId}" 
                            allowfullscreen
                            allow="fullscreen"
                            webkitallowfullscreen
                            mozallowfullscreen>
                        </iframe>
                    </div>
                `;
            }

            // Agar koi supported platform nahi hai
            alert('‚ùå This platform is not supported yet. Please use YouTube, Instagram, or Facebook URLs.');
            return null;
        }

        // Custom fullscreen function
        function toggleFullscreen(button) {
            const videoContainer = button.closest('.movie').querySelector('.video-container, .instagram-container, .facebook-container');
            const iframe = videoContainer.querySelector('iframe, video');
            
            if (!document.fullscreenElement) {
                if (videoContainer.requestFullscreen) {
                    videoContainer.requestFullscreen();
                } else if (videoContainer.webkitRequestFullscreen) {
                    videoContainer.webkitRequestFullscreen();
                } else if (videoContainer.msRequestFullscreen) {
                    videoContainer.msRequestFullscreen();
                }
                button.textContent = '‚õ∂ Exit Full Screen';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                button.textContent = '‚õ∂ Full Screen';
            }
        }

        // Categories load ‡§ï‡§∞‡§®‡§æ
        async function loadCategories() {
            try {
                const categoriesList = document.getElementById('categoriesList');
                
                categoriesList.innerHTML = `
                    <button class="category-btn active" onclick="filterByCategory('all')">All</button>
                    ${fixedCategories.map(category => `
                        <button class="category-btn" onclick="filterByCategory('${category}')">${category}</button>
                    `).join('')}
                `;
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Category ‡§ï‡•á according filter ‡§ï‡§∞‡§®‡§æ
        function filterByCategory(category) {
            currentCategory = category;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadMovies();
        }

        // Search handle ‡§ï‡§∞‡§®‡§æ
        function handleSearch() {
            currentSearch = document.getElementById('searchInput').value.toLowerCase();
            loadMovies();
        }

        // All videos show ‡§ï‡§∞‡§®‡§æ
        function showAllMovies() {
            currentCategory = 'all';
            currentSearch = '';
            document.getElementById('searchInput').value = '';
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.category-btn')[0].classList.add('active');
            
            loadMovies();
        }

        // Comments toggle ‡§ï‡§∞‡§®‡§æ - YouTube Style
        function toggleComments(button, movieId) {
            const commentsList = document.getElementById(`comments-${movieId}`);
            const toggleIcon = button.querySelector('.toggle-icon');
            
            if (commentsList.classList.contains('expanded')) {
                commentsList.classList.remove('expanded');
                toggleIcon.textContent = '‚ñ∂';
                button.innerHTML = `Show Comments <span class="toggle-icon">‚ñ∂</span>`;
            } else {
                commentsList.classList.add('expanded');
                toggleIcon.textContent = '‚ñº';
                button.innerHTML = `Hide Comments <span class="toggle-icon">‚ñº</span>`;
            }
        }

        // Videos load ‡§ï‡§∞‡§®‡§æ with filters
        async function loadMovies() {
            try {
                document.getElementById('movies').innerHTML = '<div class="loading">Loading videos...</div>';
                
                let query = supabase
                    .from('movies')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (currentCategory !== 'all') {
                    query = query.eq('category', currentCategory);
                }
                
                const { data, error } = await query;
                
                if (error) throw error;
                
                let filteredData = data;
                if (currentSearch) {
                    filteredData = data.filter(movie => 
                        movie.title.toLowerCase().includes(currentSearch) || 
                        movie.category.toLowerCase().includes(currentSearch) ||
                        (movie.description && movie.description.toLowerCase().includes(currentSearch))
                    );
                }
                
                if (filteredData.length === 0) {
                    document.getElementById('movies').innerHTML = `
                        <div class="empty-state">
                            <div>üé¨</div>
                            <p>No videos found</p>
                            <p>Try changing your search or category filter</p>
                        </div>
                    `;
                    return;
                }
                
                document.getElementById('movies').innerHTML = filteredData.map(movie => `
                    <div class="movie">
                        <div class="movie-header">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-category">${movie.category}</div>
                        </div>
                        
                        <div class="movie-description">${movie.description || 'No description available'}</div>
                        
                        ${fixIframePermissions(movie.iframe_code)}
                        
                        <!-- Professional Comments Section - YouTube Style -->
                        <div class="comments-section">
                            <div class="comments-header">
                                <div class="comments-title">Comments</div>
                                <div class="comments-count" id="comments-count-${movie.id}">0 comments</div>
                            </div>
                            
                            <div class="comment-form">
                                <input type="text" class="comment-input" id="comment-${movie.id}" 
                                       placeholder="Add a comment...">
                                <button class="comment-btn" onclick="addComment(${movie.id})">Comment</button>
                            </div>
                            
                            <div class="comments-preview" id="comments-preview-${movie.id}">
                                <!-- Latest comment preview will be loaded here -->
                            </div>
                            
                            <button class="comments-toggle" onclick="toggleComments(this, ${movie.id})">
                                Show Comments <span class="toggle-icon">‚ñ∂</span>
                            </button>
                            
                            <div class="comments-list" id="comments-${movie.id}">
                                <!-- All comments will be loaded here -->
                            </div>
                        </div>
                        
                        <div class="movie-actions">
                            <div class="user-badge">
                                üë§ ${movie.user_id || 'Unknown'}
                            </div>
                            <div>
                                <button class="fullscreen-btn" onclick="toggleFullscreen(this)">
                                    ‚õ∂ Full Screen
                                </button>
                                ${movie.user_id === currentUser ? `
                                    <button class="btn btn-danger btn-small" onclick="deleteMovie(${movie.id})">
                                        üóëÔ∏è Delete
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Load comments for each video
                filteredData.forEach(movie => {
                    loadComments(movie.id);
                });
                
            } catch (error) {
                document.getElementById('movies').innerHTML = `
                    <div style="text-align: center; color: #e50914;">
                        <p>Error: ${error.message}</p>
                        <button class="btn" onclick="loadMovies()">Try Again</button>
                    </div>
                `;
            }
        }

        // Comments load ‡§ï‡§∞‡§®‡§æ - Professional Style
        async function loadComments(movieId) {
            try {
                const { data, error } = await supabase
                    .from('comments')
                    .select('*')
                    .eq('movie_id', movieId)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const commentsContainer = document.getElementById(`comments-${movieId}`);
                const commentsPreview = document.getElementById(`comments-preview-${movieId}`);
                const commentsCount = document.getElementById(`comments-count-${movieId}`);
                
                // Update comments count
                if (commentsCount) {
                    commentsCount.textContent = `${data.length} comment${data.length !== 1 ? 's' : ''}`;
                }
                
                if (commentsContainer) {
                    if (data.length === 0) {
                        commentsContainer.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">No comments yet. Be the first to comment!</div>';
                    } else {
                        commentsContainer.innerHTML = data.map(comment => `
                            <div class="comment-item">
                                <div class="comment-user">${comment.user_name || 'Anonymous'}</div>
                                <div class="comment-text">${comment.comment_text}</div>
                                <div class="comment-time">${new Date(comment.created_at).toLocaleString()}</div>
                            </div>
                        `).join('');
                    }
                }
                
                // Show latest comment in preview
                if (commentsPreview && data.length > 0) {
                    const latestComment = data[0];
                    commentsPreview.innerHTML = `
                        <div class="preview-comment">
                            <div class="preview-user">${latestComment.user_name || 'Anonymous'}</div>
                            <div class="preview-text">${latestComment.comment_text}</div>
                        </div>
                    `;
                } else if (commentsPreview) {
                    commentsPreview.innerHTML = '';
                }
                
            } catch (error) {
                console.error('Error loading comments:', error);
            }
        }

        // Comment add ‡§ï‡§∞‡§®‡§æ
        async function addComment(movieId) {
            const commentInput = document.getElementById(`comment-${movieId}`);
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                alert('Please enter a comment');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('comments')
                    .insert([
                        { 
                            movie_id: movieId,
                            comment_text: commentText,
                            user_name: currentUser
                        }
                    ]);

                if (error) throw error;

                commentInput.value = '';
                loadComments(movieId);
                
                // Show success message
                const commentBtn = commentInput.nextElementSibling;
                const originalText = commentBtn.textContent;
                commentBtn.textContent = '‚úì Added';
                commentBtn.style.background = '#28a745';
                
                setTimeout(() => {
                    commentBtn.textContent = originalText;
                    commentBtn.style.background = '';
                }, 2000);
                
            } catch (error) {
                alert('‚ùå Error adding comment: ' + error.message);
            }
        }

        // Video add ‡§ï‡§∞‡§®‡§æ
        async function addMovie() {
            const title = document.getElementById('title').value;
            const category = document.getElementById('category').value;
            const desc = document.getElementById('desc').value;

            let iframeCode = '';

            const urlTabActive = document.getElementById('urlTab').classList.contains('active');
            
            if (urlTabActive) {
                const videoUrl = document.getElementById('videoUrl').value;
                if (!videoUrl) {
                    alert('Please enter a video URL');
                    return;
                }
                iframeCode = generateEmbedFromUrl(videoUrl);
            } else {
                const iframeInput = document.getElementById('iframeCode').value;
                if (!iframeInput) {
                    alert('Please enter embed iframe code');
                    return;
                }
                iframeCode = fixIframePermissions(iframeInput);
            }

            if (!title || !category || !iframeCode) {
                alert('Please fill all required fields');
                return;
            }

            // Check if selected category is from fixed list
            if (!fixedCategories.includes(category)) {
                alert('‚ùå Please select a valid category from the dropdown list.');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('movies')
                    .insert([
                        { 
                            title: title, 
                            category: category, 
                            iframe_code: iframeCode, 
                            description: desc,
                            user_id: currentUser
                        }
                    ]);

                if (error) throw error;

                alert('‚úÖ Video added successfully!');
                hideForm();
                
                document.getElementById('title').value = '';
                document.getElementById('category').value = '';
                document.getElementById('videoUrl').value = '';
                document.getElementById('iframeCode').value = '';
                document.getElementById('desc').value = '';
                
                loadCategories();
                loadMovies();
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }

        // Video delete ‡§ï‡§∞‡§®‡§æ
        async function deleteMovie(id) {
            if (!confirm('Are you sure you want to delete this video?')) return;
            
            try {
                const { error } = await supabase
                    .from('movies')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                alert('‚úÖ Video deleted successfully!');
                loadCategories();
                loadMovies();
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        }
    </script>
	<script type='text/javascript' src='//pl27892704.effectivegatecpm.com/d0/f8/e5/d0f8e53bef81fe3a7f6847b10e20f047.js'></script>
</body>
    </html>
